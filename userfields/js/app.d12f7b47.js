(function(e){function t(t){for(var n,i,s=t[0],o=t[1],u=t[2],c=0,f=[];c<s.length;c++)i=s[c],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&f.push(a[i][0]),a[i]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);d&&d(t);while(f.length)f.shift()();return l.push.apply(l,u||[]),r()}function r(){for(var e,t=0;t<l.length;t++){for(var r=l[t],n=!0,s=1;s<r.length;s++){var o=r[s];0!==a[o]&&(n=!1)}n&&(l.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},a={app:0},l=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/userfields/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],o=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var d=o;l.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"2d38":function(e,t,r){},"56d7":function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"nameValidator",(function(){return h})),r.d(n,"genderValidator",(function(){return b})),r.d(n,"dateValidator",(function(){return _}));var a=r("2b0e"),l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("main",[r("LayoutDefault",{scopedSlots:e._u([{key:"form",fn:function(){return[r("h2",[e._v("Form")]),r("UserForm",{attrs:{fields:e.userFields},model:{value:e.userData,callback:function(t){e.userData=t},expression:"userData"}})]},proxy:!0},{key:"out",fn:function(){return[r("h2",[e._v("Data")]),r("pre",[e._v(e._s(e.userData))])]},proxy:!0}])})],1)])},i=[],s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",[r("div",[e._t("form")],2),r("div",[e._t("out")],2)])},o=[],u=(r("773d"),r("2877")),d={},c=Object(u["a"])(d,s,o,!1,null,null,null),f=c.exports,p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ValidatorObserver",{ref:"validator"},[r("form",{attrs:{name:"userform"},on:{submit:function(t){return t.preventDefault(),e.onSubmit(t)}}},[e._l(e.form,(function(t,n){return[r("ValidatorProvider",{key:n,attrs:{name:e.fieldsMap[n].field,value:t,validator:e.fieldsMap[n].validator},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$error,l=t.$message;return[r("FormFieldView",{key:n,attrs:{error:a,message:l,field:e.fieldsMap[n]},on:{input:e.onChange},model:{value:e.form[n],callback:function(t){e.$set(e.form,n,t)},expression:"form[key]"}})]}}],null,!0)})]}))],2)])},m=[];const v=e=>{const{id:t,handler:r}=e,n=r.bind(e);return n.id=t,n},h=v({id:"nameValidator",messages:["Поле не должно быть пустым","Поле должно содержать только буквы","Поле должно содержать больше 5 символов"],handler(e){return e=e.trim(),e?/^[a-zа-я\s]+$/i.test(e)?e.length<6?this.messages[2]:"":this.messages[1]:this.messages[0]}}),b=v({id:"genderValidator",messages:["Поле не должно быть пустым","Некорректное значение поля"],handler(e){if(e=e.trim(),!e)return this.messages[0];const t=["male","female"];return t.includes(e)?"":this.messages[1]}}),_=v({id:"dateValidator",messages:["Поле не должно быть пустым","Некорректный формат даты"],handler(e){if(!e)return this.messages[0];const t=new Date(e),r="Invalid Date"!==t.toString();return r?"":this.messages[1]}});var g,y,O,S,F={name:"ValidatorObserver",computed:{error(){return this.children.some(e=>e.error)},options(){return{$error:this.$error}}},methods:{addChildren(e){this.children.push(e)},removeChildren(e){const t=this.children.indexOf(e);this.children.splice(t,1)},isValid(){return new Promise(e=>{this.$nextTick(()=>e(!this.error))})}},provide(){return{$ValidatorObserver:{addChildren:this.addChildren,removeChildren:this.removeChildren}}},data:()=>({children:[]}),render(){return this.$scopedSlots.default(this.options)}},$=F,j=Object(u["a"])($,g,y,!1,null,null,null),w=j.exports,x={name:"ValidatorProvider",inject:{$ValidatorObserver:{default:null}},props:{validator:{type:Function},value:null},computed:{message(){const{validator:e,value:t}=this;return"function"===typeof e?e(t):""},error(){return!!this.message},options(){return{$error:this.error,$message:this.message}}},render(){return this.$scopedSlots.default(this.options)}},V=x,D=Object(u["a"])(V,O,S,!1,null,null,null),k=D.exports,C=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"form__field",class:e.error?"is-error":e.type},[r("div",{staticClass:"form__field__row"},[r("label",[e._v(e._s(e.field.label))])]),r("div",{staticClass:"form__field__row"},[r("FormFieldSwitcher",e._g({attrs:{field:e.field,type:e.field.type,value:e.value}},e.$listeners))],1),e.error&&e.message?r("div",{staticClass:"form__field__message"},[e._v(e._s(e.message))]):e._e()])},E=[],P=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("date-picker",{attrs:{value:e.model,type:"datetime"},on:{input:function(t){return e.$emit("input",t)}}})},T=[],M=r("ec45"),A=(r("411c"),{name:"FormFieldDate",inheritAttrs:!1,components:{DatePicker:M["a"]},props:{value:null},computed:{model(){const{value:e}=this;return e&&new Date(e)}}}),N=A,q=Object(u["a"])(N,P,T,!1,null,null,null),I=q.exports,J=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("input",{attrs:{type:"text",name:e.name},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)}}})},L=[],R={name:"FormFieldInput",inheritAttrs:!1,props:{name:String,value:String}},U=R,G=Object(u["a"])(U,J,L,!1,null,null,null),z=G.exports,B=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("select",{domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)}}},[r("option",{attrs:{value:""}},[e._v("-- Select --")]),e._l(e.field.meta.values,(function(t){return r("option",{key:t.label,domProps:{value:t.value,textContent:e._s(t.label)}})}))],2)},Z=[],H={name:"FormFieldSelect",inheritAttrs:!1,props:{value:String,field:{type:Object,required:!0}}},K=H,Q=Object(u["a"])(K,B,Z,!1,null,null,null),W=Q.exports,X=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e._v("Компонент не поддерживает указанный тип поля")])},Y=[],ee={name:"FormFieldError"},te=ee,re=Object(u["a"])(te,X,Y,!1,null,null,null),ne=re.exports;const ae={STRING:"string",SELECT:"select",DATE:"date"},le=e=>{switch(e){case ae.STRING:return z;case ae.SELECT:return W;case ae.DATE:return I;default:return ne}};var ie,se,oe={name:"FormFieldSwitcher",functional:!0,props:{type:{type:String,required:!0}},render:(e,t)=>e(le(t.props.type),t.data,t.children)},ue=oe,de=Object(u["a"])(ue,ie,se,!1,null,null,null),ce=de.exports,fe={name:"FormFieldView",components:{FormFieldSwitcher:ce},props:{field:{type:Object,required:!0},type:String,value:null,error:Boolean,message:String}},pe=fe,me=(r("aa92"),Object(u["a"])(pe,C,E,!1,null,null,null)),ve=me.exports;const he=Object.values(n);var be={name:"UserForm",model:{prop:"data",event:"change"},components:{ValidatorObserver:w,ValidatorProvider:k,FormFieldView:ve},props:{data:{type:Object,required:!0},fields:{type:Array,required:!0}},data:()=>({form:{}}),computed:{fieldsMap(){return this.fields.reduce((e,t)=>{const r=he.find(({id:e})=>e===t.validator)||e.validator;return e[t.field]={...t,validator:r},e},{})}},methods:{onReset(){const{data:e}=this,t=JSON.parse(JSON.stringify(e));this.form=t},async onChange(){const{validator:e}=this.$refs,t=await e.isValid();t&&this.$emit("change",this.form)},async onSubmit(){}},watch:{data:{immediate:!0,handler:"onReset"}}},_e=be,ge=Object(u["a"])(_e,p,m,!1,null,null,null),ye=ge.exports,Oe={name:"App",components:{LayoutDefault:f,UserForm:ye},data:()=>({userData:{name:"User Name",gender:"male",sub:"2020-03-04T13:40:00Z"},userFields:[{label:"Name",field:"name",type:"string",validator:"nameValidator"},{label:"Gender",field:"gender",type:"select",validator:"genderValidator",meta:{values:[{label:"Male",value:"male"},{label:"Female",value:"female"}]}},{label:"Subscription",field:"sub",type:"date",validator:"dateValidator"}]})},Se=Oe,Fe=(r("5c0b"),Object(u["a"])(Se,l,i,!1,null,null,null)),$e=Fe.exports;new a["a"]({render:e=>e($e)}).$mount("#app")},"5c0b":function(e,t,r){"use strict";r("9c0c")},"773d":function(e,t,r){"use strict";r("f717")},"9c0c":function(e,t,r){},aa92:function(e,t,r){"use strict";r("2d38")},f717:function(e,t,r){}});
//# sourceMappingURL=app.d12f7b47.js.map